# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Базовые классы

### Модель данных

#### Классы

##### 1. EventEmitter
Брокер событий, реализующий реакцию на различные ивенты. Через него можно:
- подписаться на событие *on*;
- инциировать событие с данными *emit*;
- отписаться от события *off*;
- подписаться на все события *onAll*;
- сбросить все обработчики *offAll*;
- создать колбэк-триггер, генерирующий событие при вызове *trigger*.

##### 2. Api
Класс для взаимодействия с API различными методами. Благодаря нему можно:
- обработать результат запроса *handleResponse*;
- соверишть GET запрос по переданному URL *get*;
- соверишть POST запрос по переданному URL и данным *post*.

##### 3. CartModel
Класс для использования корзины. Внутри себя содержит интерфейс брокера событий, массив добавленных в корзину товаров, а также общую стоимость всех товаров. В ней можно:
- добавить товар в коризну *addItem*
- удалить товар из корзины *removeItem*
- уведомить брокера события об изменении товаров в корзине *_changed*
- подсчёт стоимости всех товаров в корзине *countPrice*
- очистить корзину и убрать все товары *clearCart*
- получение списка товаров в корзине *getItems*
- получение общей стоимости товаров в корзине *getTotal*

##### 4. CatalogModel (impl. ICatalogModel)
Содержит в себе массив с товарами (*IProduct*), а также методы:
- установка списка товаров (например после запроса по АПИ) *setItems*
- получение списка товаров в каталоге *getItems* 
- получения товара по id *getProduct*

##### 5. ProductItemModel
Класс для использования попапа с информацией о товара. Внутри себя содержит элемент кнопки, интерфейс брокера событий, который устанавливает инициацию события на кнопку "Купить", а также необходимую информацию о товаре.

##### 6. OrderFormModel
Класс для оформления заказа, содержит в себе методы для валидации введённых данных, а также собирает в себя данные пользователя:
- метод валидирует переданный ему объект с данными формы и возвращает объект с boolean валидации, а также с текстом ошибок валидации

#### Интерфейсы

##### 1. ICartModel
Интерфейс, который реализует корзина, позволяет добавлять и удалять товары, а также хранит в себе добавленные товары.
```
interface ICartModel {
    items: Map<string, number>;
    add(id: string): void;
    remove(id: string): void;
}
```

##### 2. IEventEmitter
Интерфейс брокера событий для оповещения об изменении товаров в корзине.
```
interface IEventEmitter {
    emit: (event: string, data: unknown) => void;
};
```

##### 3. IProduct
Интерфейс, который хранит в себе информацию о товаре
```
interface IProduct {
    id: string;
    title: string;
};
```

##### 4. ICatalogModel
Интерфейс, для взаимодействия с каталогом
```
interface ICatalogModel {
    items: IProduct[];
    setItems(items: IProduct[]): void;
    getItems(): IProduct[];
    getProduct(id: string): IProduct;
};
```


### Классы представления

#### Классы

##### 1. CartItemView (impl. IView)
Класс товара находящегося внутри корзины, хранит в себе id товара, а также элементы заголовка, стоимости и кнопок. В конструкторе на кнопке устанавливается слушатель. Есть метод для рендера:
- принимает в себя данные товара и возвращает готовый контейнер товара для корзины *render*

##### 2. CartView (impl. IView, ext. Modal)
Класс отображения корзины. Имеет один метод:
- принимает массив разметки, в котором, предположительно, находятся элементы товаров, после чего перезаписывает дочерние элементы новыми и возвращает контейнер *render*

##### 3. CatalogItemView (impl. IView)
Класс товара находящегося в каталоге, хранит в себе id товара, а также элементы заголовка, описания, типа, стоимости и картинки товара. В конструкторе на контейнере устанавливается слушатель. Есть метод для рендера:
- принимает в себя данные товара и возвращает готовый контейнер товара для корзины *render*

##### 4. CatalogView (impl. IView, ext. Modal)
Класс отображения у каталога:
- принимает массив разметки, в котором, предположительно, находятся элементы карточек товаров, после чего перезаписывает дочерние элементы новыми и возвращает контейнер *render*

##### 5. ProductItemView (impl. IView, ext. Modal)
Класс отображения для попапа с информацией о товаре, содержит кнопку, а также элементы описания товара:
- принимает объект с данными о товаре после чего заполняет шаблон карточки и возвращает HTMLElement *render*

##### 6. OrderFormView (impl. IView, ext. Modal)
Класс для оформления заказа, содержит в себе поля формы, темплейт удачного заказа, а также кнопки для перехода на следующий этап и оформления заказа. Хранит в себе оба темплейта формы(адрес, контакты).
- принимает в себя темплейт модального окна и возвращает HTMLElement, на основе его содержимого *render*

##### 7. Modal
Общий класс для работы модальных окон, содержит в себе кнопку закрытия модального окна, а также методы для работы с модалкьным окном:
- метод для открытия модального окна *showModal*
- метод для скрытия модального окна *hideModal*
- абстрактный метод для рендера модального окна *render*

#### Интерфейсы

##### 1. IView
Интерфейс для хранения фрагмента разметки и заполнение её данными для рендера
- метод для установки данных *render*
```
interface IView {
    render(data?: object): HTMLElement
};
```

###### 1.1. IViewConstructor
Интерфейс для создания рендеров разметок
- метод для создание нового *IView* элемента *new*
```
interface IViewConstructor {
    new(container: HTMLElement, events?: IEventEmitter): IView;
};
```

## Основные типы

- ### Product
Базовый объект продукта, который содержит в себе всю информацию о товаре
```
type Product = {
    id: string,
    description: string,
    image: string,
    title: string,
    category: string,
    price: number
};
```

- ### ProductList
Объект листа продуктов, который содержит в себе массив продуктов и их количество. Является шаблоном для ответа сервера
```
type ProductList = {
    total: number,
    items: Product[]
}
```

- ### OrderForm
Объект данных пользователя для заказа. Содержит необходимую информацию для заказа
```
type OrderForm = {
    paymentMethod: "Онлайн" | "При получении",
    address: string,
    email: string,
    phone: string
};
```

## Логика связки слоёв
Вся связь между слоями будет работать за счёт брокера событий, который при возникновении определённых событий в одном слое будет вызывать колбэк который внесёт необходимые изменения.

Все события на сайте:
```
enum Events {
    PRODUCT_OPEN = 'product:changed', // Клик по карточке в каталоге
    CART_ADD = 'cart:addItem', // Добавление товара в коризну
    CART_REMOVE = 'cart:removeItem', // Удаление товара из корзины
    CART_CHANGE = 'cart:changed', // Изменение состава корзины
    CART_CLEAR = 'cart:clear', // Очистка корзины
    MODAL_OPEN = 'modal:open', // Открытие модального окна
    MODAL_CLOSE = 'modal:close', // Закрытие модального окна
    FORM_INIT = 'form:init', // Старт формы оформления заказа
    FORM_NEXT = 'form:next', // Переход на следующий этап оформления заказа
    FORM_SUBMIT = 'form:submit', // Отправка заказа
}
```